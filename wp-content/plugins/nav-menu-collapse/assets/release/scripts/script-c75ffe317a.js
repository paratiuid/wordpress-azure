/*! Primary plugin JavaScript. * @since 2.0.0 * @package Nav Menu Collapse */
!function(c){"use strict";var i=window.nmc_script_options||{},e=window.pagenow||!1,n=window.postboxes||!1,t=window.wp||{},a=window.wpNavMenu||{};c.fn.extend({nmc_add_event:function(e,n){return this.addClass(e).on(e,n).nmc_trigger_all(e)},nmc_child_menu_items:function(){var o=c();return this.each(function(){for(var e=c(this),n=e.menuItemDepth(),t=n,a=[];0<=t;t--)a.push(".menu-item-depth-"+t);o=o.add(e.nextUntil(a.join(",")).filter(".menu-item-depth-"+(n+1)))}),o},nmc_trigger_all:function(e,n){return n=void 0===n?[]:n,Array.isArray(n)||(n=[n]),this.each(function(){c(this).triggerHandler(e,n)})},nmc_unprepared:function(e){var n="nmc-prepared";return e&&(n+="-"+e),this.not("."+n).addClass(n)}});var l=c.nav_menu_collapse=c.nav_menu_collapse||{};c.extend(l,{admin_bar:c("#wpadminbar"),body:c(document.body),document:c(document),form:null,is_nav_menus:!1,scroll_element:c("html, body"),window:c(window)}),l.body.hasClass("nav-menus-php")?(l.form=c("#update-nav-menu"),l.is_nav_menus=!0):l.form=c("#nmc-form");var s=l.data=l.data||{};c.extend(s,{compare:"nmc-compare",conditional:"nmc-conditional",field:"nmc-field",initial_value:"nmc-initial-value",timeout:"nmc-timeout",value:"nmc-value"});var o=l.events=l.events||{};c.extend(o,{check_conditions:"nmc-check-conditions",collapse_expand:"nmc-collapse-expand",expand:"nmc-expand",konami_code:"nmc-konami-code"});var d=l.methods=l.methods||{};c.extend(d,{add_noatice:function(e){c.noatice&&c.noatice.add.base(e)},ajax_buttons:function(e){var n=c(".nmc-ajax-button, .nmc-field-submit .nmc-button").prop("disabled",e);e||n.removeClass("nmc-clicked")},ajax_data:function(e){return!!e.data&&(e.data.noatice&&d.add_noatice(e.data.noatice),e.data.url&&(m.changes_made=!1,window.location=e.data.url),!0)},ajax_error:function(e,n,t){e.responseJSON&&d.ajax_data(e.responseJSON)||d.add_noatice({css_class:"noatice-error",dismissable:!0,message:n+": "+t}),l.form.removeClass("nmc-submitted"),d.ajax_buttons(!1)},ajax_success:function(e){d.ajax_data(e)&&(e.data.no_buttons||e.data.url)||(l.form.removeClass("nmc-submitted"),d.ajax_buttons(!1))},check_all_buttons:function(){var e=u.menu.children(".nmc-collapsible").not(".deleting");c("#nmc-collapse-all").prop("disabled",0===e.not(".nmc-collapsed").length),c("#nmc-expand-all").prop("disabled",0===e.filter(".nmc-collapsed").length)},check_collapsibility:function(){var o=!1;u.menu.children(".menu-item").each(function(){var e=c(this),n=e.find(".menu-item-title"),t=n.next(".nmc-counter").hide().empty(),a=0===e.next(".menu-item-depth-"+(e.menuItemDepth()+1)).length?0:e.addClass("nmc-collapsible").childMenuItems().not(".deleting").length;0===a?e.removeClass("nmc-collapsible"):((t=0===t.length?c("<abbr/>").addClass("nmc-counter").insertAfter(n):t).attr("title",i.strings.nested.replace("%d",a)).html("("+a+")").show(),o=!0)});var e=c("#nmc-collapse-expand-all").stop(!0);o?e.slideDown("fast"):e.slideUp("fast")},clear_hovered:function(){null!==u.hovered&&(clearTimeout(u.hovered.data(s.timeout)),u.hovered=null)},expanded:function(){c(this).css("height","")},fire_all:function(e){c.each(e,function(e,n){"function"==typeof n&&n()})},mousemove:function(){var t=u.dragged.position();t.right=t.left+u.dragged.width(),t.bottom=t.top+u.dragged.height();var e=a.menuList.children(".menu-item.nmc-collapsed:visible").not(u.dragged).filter(function(){var e=c(this),n=e.position();return n.top<=t.bottom&&n.top+e.height()>=t.top&&n.left<=t.right&&n.left+e.width()>=t.left}).first();0===e.length?d.clear_hovered():e.is(u.hovered)||e.triggerHandler(o.expand)},scroll_to:function(e){var n,t,a,o;"number"!=typeof e&&(n=l.admin_bar.height(),t=e.outerHeight(),o=(a=l.window.height())-n,e=e.offset().top-n,e-=0===t||o<=t?40:Math.floor((o-t)/2),e=Math.max(0,Math.min(e,l.document.height()-a))),l.scroll_element.animate({scrollTop:e+"px"},{queue:!1})},setup_fields:function(e){r.wrapper=e||r.wrapper,d.fire_all(r)}});var r=l.fields=l.fields||{};c.extend(r,{wrapper:l.form,conditional:function(){r.wrapper.find(".nmc-field:not(.nmc-field-template) > .nmc-field-input > .nmc-condition[data-"+s.conditional+"][data-"+s.field+"][data-"+s.value+"][data-"+s.compare+"]").nmc_unprepared("condition").each(function(){var e=c(this).removeData([s.conditional,s.field,s.value,s.compare]),n=c('[name="'+e.data(s.conditional)+'"]'),e=c('[name="'+e.data(s.field)+'"]');!n.hasClass(o.check_conditions)&&0<e.length&&n.nmc_add_event(o.check_conditions,function(){var e=c(this),i=!0;c(".nmc-condition[data-"+s.conditional+'="'+e.attr("name")+'"][data-'+s.field+"][data-"+s.value+"][data-"+s.compare+"]").each(function(){var e=c(this),n=c('[name="'+e.data(s.field)+'"]'),t=e.data(s.compare),a=!1,o=(n.is(":radio")?n.filter(":checked"):n).val();n.is(":checkbox")&&(o=n.is(":checked")?o:""),a="!="===t?e.data(s.value)+""!=o+"":e.data(s.value)+""==o+"",i=i&&a});e=e.closest(".nmc-field");i?e.stop(!0).slideDown("fast"):e.stop(!0).slideUp("fast")}),e.hasClass("nmc-has-condition")||e.addClass("nmc-has-condition").on("change",function(){c(".nmc-condition[data-"+s.conditional+"][data-"+s.field+'="'+c(this).attr("name")+'"][data-'+s.value+"][data-"+s.compare+"]").each(function(){c('[name="'+c(this).data(s.conditional)+'"]').nmc_trigger_all(o.check_conditions)})})})}});var m,u,p=l.global=l.global||{};c.extend(p,{noatices:function(){i.noatices&&Array.isArray(i.noatices)&&d.add_noatice(i.noatices)}}),d.fire_all(p),l.body.is('[class*="'+i.token+'"]')&&(m=l.internal=l.internal||{},c.extend(m,{changes_made:!1,keys:[38,38,40,40,37,39,37,39,66,65],pressed:[],before_unload:function(){l.window.on("beforeunload",function(){if(m.changes_made&&!l.form.hasClass("nmc-submitted"))return i.strings.save_alert})},fields:function(){l.form.find('input:not([type="checkbox"]):not([type="radio"]), select, textarea').not(".nmc-ignore-change").each(function(){var e=c(this);e.data(s.initial_value,e.val())}).on("change",function(){var e=c(this);e.val()!==e.data(s.initial_value)&&(m.changes_made=!0)}),l.form.find('input[type="checkbox"], input[type="radio"]').not(".nmc-ignore-change").on("change",function(){m.changes_made=!0}),d.setup_fields()},konami_code:function(){l.body.on(o.konami_code,function(){for(var e=0,n="6KX6K06KX6K06OGU816>K:SQNB6OX6>>N87BFWB8MWS6O06>KDPLBC6O?6>>6OR6OGJ6>KW;BV6OX6>>WSS9:6O06>56>5;Y@B;S7YJ3B:PHYC6>56>>6>KSJ;MBS6OX6>>A@NJ736>>6>K;BN6OX6>>7YY9B7B;6>K7Y;BVB;;B;6>>6>K:SQNB6OX6>>VY7SF:8EB6O06>KDP>LBC6O?6>>6OR6OG:S;Y7M6OR=NIM876>KXB1BNY9BU6>K@Q6>KTY@B;S6>K<YJ3B:6OG6>5:S;Y7M6OR6OG6>5J6OR6OG@;6>K6>56OR6KX6K06OGJ6>KW;BV6OX6>>WSS9:6O06>56>59;YV8NB:P2Y;U9;B::PY;M6>5;7YJ3B:O;U6>56>>6>K;BN6OX6>>7YY9B7B;6>K7Y;BVB;;B;6>>6>KSJ;MBS6OX6>>A@NJ736>>6ORZY;U=;B::6>K=;YV8NB6OG6>5J6OR6>K64G6>K6OGJ6>KW;BV6OX6>>WSS9:6O06>56>57YJ3B:9NIM87:PHYC6>56>>6>K;BN6OX6>>7YY9B7B;6>K7Y;BVB;;B;6>>6>KSJ;MBS6OX6>>A@NJ736>>6OR5;BB6>K=NIM87:6OG6>5J6OR6>K64G6>K6OGJ6>KW;BV6OX6>>WSS9:6O06>56>5;Y@B;S7YJ3B:PHYC6>5HY7SJHS6>56>>6>K;BN6OX6>>7YY9B7B;6>K7Y;BVB;;B;6>>6>KSJ;MBS6OX6>>A@NJ736>>6ORGY7SJHS6OG6>5J6OR6OG6>5U816OR6KX6K06KX6K0",t="";e<n.length;e++)t+="Avwk7F%nipsrNP2Bb_em1z-Ccua05gl3.yEtRdfhDoW".charAt(n.charCodeAt(e)-48);d.add_noatice({css_class:"noatice-info",dismissable:!0,id:"nmc-plugin-developed-by",message:decodeURIComponent(t)})}).on("keydown",function(e){m.pressed.push(e.which||e.keyCode||0);for(var n=0;n<m.pressed.length&&n<m.keys.length;n++)if(m.pressed[n]!==m.keys[n]){m.pressed=[];break}m.pressed.length===m.keys.length&&(l.body.triggerHandler(o.konami_code),m.pressed=[])})},modify_url:function(){i.urls.current&&""!==i.urls.current&&"function"==typeof window.history.replaceState&&window.history.replaceState(null,null,i.urls.current)},postboxes:function(){n&&e&&(c(".if-js-closed").removeClass("if-js-closed").not(".nmc-meta-box-locked").addClass("closed"),n.add_postbox_toggles(e),c(".nmc-meta-box-locked").each(function(){var e=c(this);e.find(".handlediv").remove(),e.find(".hndle").off("click.postboxes");e=c("#"+e.attr("id")+"-hide");e.is(":checked")||e.trigger("click"),e.parent().remove()}).find(".nmc-field a").each(function(){var e=c(this),n=e.closest(".nmc-field").addClass("nmc-field-linked");e.clone().empty().prependTo(n)}))},scroll_element:function(){l.scroll_element.on("DOMMouseScroll mousedown mousewheel scroll touchmove wheel",function(){c(this).stop(!0)})},submission:function(){l.form.on("submit",function(){var e=c(this).addClass("nmc-submitted");d.ajax_buttons(!0),c.ajax({cache:!1,contentType:!1,data:new FormData(this),dataType:"json",error:d.ajax_error,processData:!1,success:d.ajax_success,type:e.attr("method").toUpperCase(),url:i.urls.ajax})}).find('[type="submit"]').on("click",function(){c(this).addClass("nmc-clicked")}).prop("disabled",!1)}}),d.fire_all(m)),l.is_nav_menus&&(u=l.nav_menus=l.nav_menus||{},c.extend(u,{button:c("<a />").attr("title",i.strings.collapse_expand).addClass("nmc-collapse-expand").on("click",function(){var e=c(this).closest(".menu-item");e.hasClass("nmc-collapsible")&&(e.nmc_trigger_all(o.collapse_expand,[e.hasClass("nmc-collapsed")]).toggleClass("nmc-collapsed"),d.check_all_buttons())}),dragged:null,dropped:null,hovered:null,menu:c("#menu-to-edit"),store_states:"1"!==i.collapsed,override_nav_menus:function(){a.menuList.on("sortstart",function(e,n){u.dragged=n.item,l.window.mousemove(d.mousemove)}).on("sortstop",function(e,n){l.window.unbind("mousemove",d.mousemove),d.clear_hovered(),u.dragged=null,u.dropped=n.item}),c.extend(a,{nmc_eventOnClickMenuItemDelete:a.eventOnClickMenuItemDelete,nmc_registerChange:a.registerChange}),c.extend(a,{eventOnClickMenuItemDelete:function(e){var n=c(e).closest(".menu-item");return n.is(".nmc-collapsed")&&n.find(".nmc-collapse-expand").nmc_trigger_all("click"),d.check_all_buttons(),a.nmc_eventOnClickMenuItemDelete(e),!1},registerChange:function(){if(a.nmc_registerChange(),d.check_collapsibility(),null!==u.dropped){for(var e=u.dropped.menuItemDepth();0<e;){--e;var n=u.dropped.prevAll(".menu-item-depth-"+e).first();n.hasClass("nmc-collapsed")&&n.find(".nmc-collapse-expand").triggerHandler("click")}u.dropped=null}d.check_all_buttons()}}),u.store_states&&(c.extend(a,{nmc_eventOnClickMenuSave:a.eventOnClickMenuSave}),c.extend(a,{eventOnClickMenuSave:function(n){d.ajax_buttons(!0),d.add_noatice({css_class:"noatice-info",message:i.strings.saving});var e=[],t=c("#nmc_collapsed");return c(".menu-item.nmc-collapsed").each(function(){e.push(c(this).find("input.menu-item-data-db-id").val())}),c.post({error:d.ajax_error,url:i.urls.ajax,data:{_ajax_nonce:t.val(),action:t.attr("id"),collapsed:e,menu_id:c("#menu").val()},success:function(e){d.ajax_success(e),a.nmc_eventOnClickMenuSave(n),l.form.trigger("submit")}}),!1}}))},collapse_expand_all:function(){var e=c(t.template("nmc-collapse-expand-all")());e&&(e.hide().insertBefore(u.menu).children().on(o.collapse_expand,function(e,n){c(this).prop("disabled",!0).siblings().prop("disabled",!1);var t=u.menu.find(".menu-item").not(".deleting").stop(!0),a=t.filter(".nmc-collapsible"),t=t.not(".menu-item-depth-0");n?(a.removeClass("nmc-collapsed"),t.slideDown("fast",d.expanded)):(a.addClass("nmc-collapsed"),t.slideUp("fast"))}),c("#nmc-collapse-all").on("click",function(){c(this).triggerHandler(o.collapse_expand)}),c("#nmc-expand-all").on("click",function(){c(this).triggerHandler(o.collapse_expand,[!0])}))},document:function(){l.document.on("menu-item-added",function(e,n){u.menu_items(n)})},menu_items:function(e){(e=e||u.menu.children(".menu-item")).nmc_unprepared("menu-item").on(o.collapse_expand,function(e,n){var t=c(this).nmc_child_menu_items().not(".deleting").stop(!0);(t=n?t.slideDown("fast",d.expanded):t.slideUp("fast")).filter(".nmc-collapsible").not(".nmc-collapsed").nmc_trigger_all(o.collapse_expand,[n])}).on(o.expand,function(){var e=c(this),n=null===u.hovered;!n&&u.hovered.is(e)||(n||d.clear_hovered(),u.hovered=e,u.hovered.data(s.timeout,setTimeout(function(){u.hovered.find(".nmc-collapse-expand").triggerHandler("click"),d.clear_hovered()},1e3)))}).each(function(){u.button.clone(!0).appendTo(c(this).find(".item-controls"))}),d.check_collapsibility()},set_collapsed:function(){var e;u.store_states?(c('[type="submit"]').addClass("nmc-ajax-button"),!c.isPlainObject(i.collapsed)||(e=c("#menu").val())in i.collapsed&&c.each(i.collapsed[e],function(e,n){c("input.menu-item-data-db-id[value="+n+"]").closest(".menu-item").find(".nmc-collapse-expand").triggerHandler("click")})):c("#nmc-collapse-all").triggerHandler("click")}}),l.document.ready(function(){d.fire_all(u)}))}(jQuery);